# seacontact.com

Social network platform for seamans;


## Deployment 

### Deploying with docker-compose
```shell
# login to docker hub
docker login -u zzzloy777

# run sh scripts in each directory to build latest images and push them to docker-hub:
cd ./php && sh build.sh
cd ./nginx && sh build.sh

# copy envs from .env-local.example or .env-server.example to .env according to your environment:
cp ./.env-local.example .env

# wind up the project:
docker-compose up --force-recreate 
```

### Deploying with kubernetes

- login to cluster and setup context
```shell
gcloud auth login // login to gcloud (nguita.erik@gmail.com)
gcloud config set project seacontact
gcloud config set compute/zone europe-west4-a

# use existing cluster ez and get kubernetes credentials:
gcloud container clusters get-credentials ez --zone europe-west4-a 
kubectl config use-context gke_seacontact_europe-west4-a_ez 
```

- copy db static files:
```shell
# run up utility pod if needed: (transfer files/manage storage)
kubectl apply -f ./deployment/zonal/util.yaml

# get local directory size:
du -sh ./db

# copy files to root directory
tar cf - ./db | pv -s 2300M | kubectl exec -i ez-util -- tar xf -

# ssh to utility pod and move transfered folder
kubectl exec -ti ez-util -- /bin/bash
root@ez-util:/# mv ./db ./transfer/seacontact.com/
```

- run up deployments & configure ingress/dns
```shell
# run db deployment
kubectl apply -f ./deployment/db-deployment.yaml
kubectl apply -f ./deployment/api-deployment.yaml

# add ingress controller if not installed yet:
#kubectl apply -f https://projectcontour.io/quickstart/contour.yaml

# update dns records:
gcloud dns --project=seacontact record-sets update seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update admin.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update api.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update en.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update ru.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update phpmyadmin.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"

gcloud dns --project=seacontact record-sets update www.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update www.admin.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update www.api.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update www.en.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update www.ru.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"
gcloud dns --project=seacontact record-sets update www.phpmyadmin.seacontact.com. --type="A" --zone="seacontact" --rrdatas="34.147.82.47" --ttl="300"

```



# TODO:
- fix static images for users
